# API Configuration Management System

## æ¦‚è¿°

AIç»˜å›¾å¹³å°çš„APIé…ç½®ç®¡ç†ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„å¤šAPIæ”¯æŒã€è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚ç³»ç»Ÿæ”¯æŒå›¾ç‰‡ç”Ÿæˆå’Œè§†é¢‘ç”Ÿæˆä¸¤ç§ç±»å‹çš„APIé…ç½®ã€‚

## ğŸŒŸ ä¸»è¦ç‰¹æ€§

### âœ… å¤šAPIæ”¯æŒ
- **å›¾ç‰‡ç”Ÿæˆ**: OpenAI DALL-E, Stability AI, Replicate, è‡ªå®šä¹‰API
- **è§†é¢‘ç”Ÿæˆ**: Runway, Pika Labs, Stable Video Diffusion, è‡ªå®šä¹‰API
- **çµæ´»é…ç½®**: æ¯ç§ç±»å‹å¯é…ç½®å¤šä¸ªAPIæä¾›å•†

### âœ… è‡ªåŠ¨æ•…éšœè½¬ç§»
- **ä¼˜å…ˆçº§ç³»ç»Ÿ**: æŒ‰ä¼˜å…ˆçº§è‡ªåŠ¨é€‰æ‹©API
- **æ™ºèƒ½é‡è¯•**: å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼Œé‡è¯•æ¬¡æ•°å¯é…ç½®
- **å¿«é€Ÿåˆ‡æ¢**: é‡åˆ°é€Ÿç‡é™åˆ¶æˆ–é”™è¯¯æ—¶ç«‹å³åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªAPI

### âœ… è´Ÿè½½å‡è¡¡ä¸ç›‘æ§
- **é€Ÿç‡é™åˆ¶**: æ¯ä¸ªAPIç‹¬ç«‹çš„é€Ÿç‡é™åˆ¶ç®¡ç†
- **ä½¿ç”¨ç»Ÿè®¡**: è¯¦ç»†çš„APIä½¿ç”¨æ—¥å¿—å’Œç»Ÿè®¡
- **å¥åº·æ£€æŸ¥**: å®æ—¶ç›‘æ§APIå¥åº·çŠ¶æ€

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–æ•°æ®åº“

é¦–å…ˆåœ¨Supabaseä¸­æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ï¼š

```sql
-- æ‰§è¡Œ lib/database/migrations/004_api_configs.sql
-- è¿™å°†åˆ›å»º api_configs å’Œ api_usage_logs è¡¨
```

### 2. è®¿é—®ç®¡ç†ç•Œé¢

ç®¡ç†å‘˜ç™»å½•åè®¿é—®ï¼š`/admin/dashboard` â†’ `API Configs` æ ‡ç­¾é¡µ

### 3. æ·»åŠ ç¬¬ä¸€ä¸ªAPIé…ç½®

ç‚¹å‡» "Add API Config" æŒ‰é’®ï¼Œé€‰æ‹©æä¾›å•†å¹¶å¡«å†™é…ç½®ä¿¡æ¯ã€‚

## ğŸ“‹ APIé…ç½®å­—æ®µè¯´æ˜

### åŸºæœ¬ä¿¡æ¯
- **Configuration Name**: APIé…ç½®çš„æ˜¾ç¤ºåç§°
- **API Type**: `image_generation` æˆ– `video_generation`
- **Provider**: é€‰æ‹©é¢„å®šä¹‰çš„æä¾›å•†æˆ–è‡ªå®šä¹‰
- **Priority**: ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜

### è¿æ¥é…ç½®
- **Base URL**: APIçš„åŸºç¡€URL
- **Endpoint Path**: å…·ä½“çš„APIç«¯ç‚¹è·¯å¾„
- **API Key**: APIå¯†é’¥ï¼ˆæ”¯æŒæ˜¾ç¤º/éšè—ï¼‰
- **Model Name**: ä½¿ç”¨çš„æ¨¡å‹åç§°

### é«˜çº§è®¾ç½®
- **Max Retries**: æœ€å¤§é‡è¯•æ¬¡æ•° (0-10)
- **Timeout**: è¶…æ—¶æ—¶é—´ï¼Œç§’ (10-300)
- **Rate Limit**: æ¯åˆ†é’Ÿè¯·æ±‚é™åˆ¶
- **Active**: æ˜¯å¦å¯ç”¨æ­¤é…ç½®
- **Set as Default**: æ˜¯å¦è®¾ä¸ºé»˜è®¤API

### é…ç½®æ•°æ® (JSON)
æä¾›å•†ç‰¹å®šçš„é…ç½®å‚æ•°ï¼Œä¾‹å¦‚ï¼š

```json
{
  "quality": "standard",
  "size": "1024x1024",
  "style": "vivid"
}
```

## ğŸ”§ æ”¯æŒçš„APIæä¾›å•†

### å›¾ç‰‡ç”Ÿæˆ ğŸ¨

#### OpenAI DALL-E 3
```json
{
  "base_url": "https://api.openai.com/v1",
  "endpoint": "/images/generations",
  "model": "dall-e-3",
  "config_data": {
    "quality": "standard",
    "size": "1024x1024",
    "style": "vivid"
  }
}
```

#### Stability AI SDXL
```json
{
  "base_url": "https://api.stability.ai/v1",
  "endpoint": "/generation/stable-diffusion-xl-1024-v1-0/text-to-image",
  "model": "stable-diffusion-xl-1024-v1-0",
  "config_data": {
    "samples": 1,
    "steps": 30,
    "cfg_scale": 7
  }
}
```

#### Replicate
```json
{
  "base_url": "https://api.replicate.com/v1",
  "endpoint": "/predictions",
  "model": "stability-ai/sdxl",
  "config_data": {
    "width": 1024,
    "height": 1024,
    "num_outputs": 1
  }
}
```

### è§†é¢‘ç”Ÿæˆ ğŸ¬

#### Runway Gen-2
```json
{
  "base_url": "https://api.runwayml.com/v1",
  "endpoint": "/generate",
  "model": "gen2",
  "config_data": {
    "duration": 4,
    "seed": 0,
    "upscale": false
  }
}
```

#### Pika Labs
```json
{
  "base_url": "https://api.pika.art/v1",
  "endpoint": "/generate",
  "model": "pika-1.0",
  "config_data": {
    "fps": 24,
    "aspect_ratio": "16:9",
    "camera_motion": "static"
  }
}
```

## ğŸ’» å¼€å‘è€…ä½¿ç”¨æŒ‡å—

### ä½¿ç”¨APIç®¡ç†å™¨

```typescript
import { apiManager } from '@/lib/services/api-manager'

// ç”Ÿæˆå›¾ç‰‡
const result = await apiManager.generateImage(
  'A beautiful sunset over mountains',
  { style: 'vivid', size: '1024x1024' },
  userId
)

// ç”Ÿæˆè§†é¢‘
const result = await apiManager.generateVideo(
  'A cat playing with a ball',
  { duration: 4, fps: 24 },
  userId
)
```

### APIå“åº”æ ¼å¼

```typescript
interface ApiResponse {
  success: boolean
  data?: any           // ç”Ÿæˆçš„å†…å®¹æ•°æ®
  error?: string       // é”™è¯¯ä¿¡æ¯
  response_time_ms?: number  // å“åº”æ—¶é—´
  api_config_id?: string     // ä½¿ç”¨çš„APIé…ç½®ID
}
```

### åœ¨è·¯ç”±ä¸­ä½¿ç”¨

```typescript
// app/api/generate/image/route.ts
import { apiManager } from '@/lib/services/api-manager'

export async function POST(request: NextRequest) {
  const { prompt, ...options } = await request.json()
  
  const result = await apiManager.generateImage(
    prompt,
    options,
    session.user.id
  )
  
  if (!result.success) {
    return NextResponse.json({ error: result.error }, { status: 500 })
  }
  
  return NextResponse.json({ 
    success: true, 
    data: result.data 
  })
}
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡

ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹ï¼š
- APIè°ƒç”¨æ€»æ•°å’ŒæˆåŠŸç‡
- å„æä¾›å•†çš„ä½¿ç”¨æƒ…å†µ
- å¹³å‡å“åº”æ—¶é—´
- é”™è¯¯æ—¥å¿—å’Œæ•…éšœæ’é™¤ä¿¡æ¯

### APIä½¿ç”¨æ—¥å¿—

ç³»ç»Ÿè‡ªåŠ¨è®°å½•ï¼š
- æ¯æ¬¡APIè°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯
- å“åº”æ—¶é—´å’ŒçŠ¶æ€
- ç”¨æˆ·ä¿¡æ¯å’Œè¯·æ±‚å‚æ•°
- é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•æ•°æ®

## âš¡ æ•…éšœè½¬ç§»æœºåˆ¶

### è‡ªåŠ¨åˆ‡æ¢é€»è¾‘

1. **æŒ‰ä¼˜å…ˆçº§å°è¯•**: ä»ä¼˜å…ˆçº§æœ€é«˜çš„APIå¼€å§‹
2. **é‡è¯•æœºåˆ¶**: å¤±è´¥æ—¶æŒ‰é…ç½®çš„æ¬¡æ•°é‡è¯•
3. **æ™ºèƒ½åˆ‡æ¢**: é‡åˆ°é€Ÿç‡é™åˆ¶ç«‹å³åˆ‡æ¢
4. **å…¨é¢è¦†ç›–**: æ‰€æœ‰APIå¤±è´¥æ—¶è¿”å›è¯¦ç»†é”™è¯¯ä¿¡æ¯

### æ•…éšœç±»å‹å¤„ç†

- **ç½‘ç»œè¶…æ—¶**: è‡ªåŠ¨é‡è¯•ï¼Œç„¶ååˆ‡æ¢
- **é€Ÿç‡é™åˆ¶**: ç«‹å³åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªAPI
- **è®¤è¯é”™è¯¯**: è®°å½•é”™è¯¯ï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªAPI
- **æœåŠ¡ä¸å¯ç”¨**: æ ‡è®°APIçŠ¶æ€ï¼Œè‡ªåŠ¨åˆ‡æ¢

## ğŸ” å®‰å…¨è€ƒè™‘

### APIå¯†é’¥ç®¡ç†

- **åŠ å¯†å­˜å‚¨**: APIå¯†é’¥å®‰å…¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­
- **æƒé™æ§åˆ¶**: åªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹é…ç½®
- **æ©ç æ˜¾ç¤º**: ç•Œé¢ä¸­APIå¯†é’¥é»˜è®¤éšè—

### è®¿é—®æ§åˆ¶

- **ç®¡ç†å‘˜æƒé™**: åªæœ‰ç®¡ç†å‘˜å¯ä»¥ç®¡ç†APIé…ç½®
- **ç”¨æˆ·æ—¥å¿—**: è®°å½•ç”¨æˆ·çš„APIä½¿ç”¨æƒ…å†µ
- **å®¡è®¡è¿½è¸ª**: å®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### APIé…ç½®æµ‹è¯•å¤±è´¥
1. æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
3. éªŒè¯APIé…é¢æ˜¯å¦å……è¶³
4. æ£€æŸ¥è¯·æ±‚æ ¼å¼æ˜¯å¦æ­£ç¡®

#### æ•…éšœè½¬ç§»ä¸å·¥ä½œ
1. ç¡®è®¤æœ‰å¤šä¸ªæ´»è·ƒçš„APIé…ç½®
2. æ£€æŸ¥ä¼˜å…ˆçº§è®¾ç½®æ˜¯å¦æ­£ç¡®
3. éªŒè¯é‡è¯•æ¬¡æ•°é…ç½®
4. æŸ¥çœ‹APIä½¿ç”¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯

#### é€Ÿç‡é™åˆ¶é¢‘ç¹è§¦å‘
1. è°ƒæ•´é€Ÿç‡é™åˆ¶é…ç½®
2. å¢åŠ æ›´å¤šAPIæä¾›å•†
3. ä¼˜åŒ–è¯·æ±‚é¢‘ç‡
4. è€ƒè™‘å‡çº§APIå¥—é¤

### è°ƒè¯•æŠ€å·§

```typescript
// å¯ç”¨è¯¦ç»†æ—¥å¿—
console.log('ğŸš€ Trying API:', apiConfig.name)
console.log('âœ… Success rate:', successRate)
console.log('âŒ Error details:', errorMessage)

// æŸ¥çœ‹APIç»Ÿè®¡
const stats = await apiManager.getApiStats(24) // è¿‡å»24å°æ—¶
console.log('API Statistics:', stats)
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æœ€ä½³å®è·µ

1. **åˆç†è®¾ç½®ä¼˜å…ˆçº§**: å°†æœ€å¿«æœ€ç¨³å®šçš„APIè®¾ä¸ºæœ€é«˜ä¼˜å…ˆçº§
2. **é…ç½®é€‚å½“çš„è¶…æ—¶**: å¹³è¡¡å“åº”é€Ÿåº¦å’ŒæˆåŠŸç‡
3. **ç›‘æ§ä½¿ç”¨æƒ…å†µ**: å®šæœŸæŸ¥çœ‹ç»Ÿè®¡æ•°æ®ä¼˜åŒ–é…ç½®
4. **åˆ†æ•£é£é™©**: é…ç½®å¤šä¸ªä¸åŒæä¾›å•†çš„API

### æ‰©å±•å»ºè®®

- **ç¼“å­˜æœºåˆ¶**: ä¸ºç›¸ä¼¼è¯·æ±‚æ·»åŠ ç¼“å­˜
- **è´Ÿè½½å‡è¡¡**: æ ¹æ®APIæ€§èƒ½åŠ¨æ€è°ƒæ•´ä½¿ç”¨ç­–ç•¥
- **æˆæœ¬ä¼˜åŒ–**: æ ¹æ®APIä»·æ ¼å’Œè´¨é‡åˆ¶å®šä½¿ç”¨ç­–ç•¥
- **ç›‘æ§å‘Šè­¦**: é…ç½®APIæ•…éšœè‡ªåŠ¨å‘Šè­¦

## ğŸ¯ æ€»ç»“

APIé…ç½®ç®¡ç†ç³»ç»Ÿä¸ºAIç»˜å›¾å¹³å°æä¾›äº†ï¼š

âœ… **é«˜å¯ç”¨æ€§**: å¤šAPIæ•…éšœè½¬ç§»ç¡®ä¿æœåŠ¡ä¸ä¸­æ–­  
âœ… **çµæ´»é…ç½®**: æ”¯æŒå„ç§ä¸»æµAIæœåŠ¡æä¾›å•†  
âœ… **æ™ºèƒ½ç®¡ç†**: è‡ªåŠ¨åŒ–çš„è´Ÿè½½å‡è¡¡å’Œé”™è¯¯å¤„ç†  
âœ… **è¯¦ç»†ç›‘æ§**: å®Œæ•´çš„ä½¿ç”¨ç»Ÿè®¡å’Œæ—¥å¿—ç³»ç»Ÿ  
âœ… **å®‰å…¨å¯é **: å®Œå–„çš„æƒé™æ§åˆ¶å’Œæ•°æ®ä¿æŠ¤  

é€šè¿‡è¿™ä¸ªç³»ç»Ÿï¼Œç®¡ç†å‘˜å¯ä»¥è½»æ¾ç®¡ç†å¤šä¸ªAI APIï¼Œç¡®ä¿ç”¨æˆ·å§‹ç»ˆèƒ½å¤Ÿè·å¾—æœ€ä½³çš„ç”Ÿæˆä½“éªŒï¼ ğŸš€ 