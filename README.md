# ğŸ¨ Aimagica - AI Image Generator & Art Creation Platform

[![Website](https://img.shields.io/badge/Website-aimagica.ai-blue)](https://aimagica.ai)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![AI Powered](https://img.shields.io/badge/AI-Powered-purple.svg)](https://aimagica.ai)

**Aimagica** is a cutting-edge AI-powered image generation platform that transforms your ideas into stunning visual art. Create professional-quality images from text descriptions, edit existing images with advanced AI tools, and explore endless creative possibilities.

## ğŸŒŸ Features

### âœ¨ AI Image Generation
- **Text to Image**: Transform any text description into beautiful artwork
- **Image to Image**: Upload images and apply AI transformations
- **Multiple Art Styles**: Choose from dozens of artistic styles including:
  - Realistic Photography
  - Digital Art & Illustration
  - Fantasy & Sci-Fi
  - Vintage & Retro
  - Anime & Manga
  - Abstract & Modern Art

### ğŸ¯ Advanced Tools
- **Smart Sketch Canvas**: Draw and edit images with AI assistance
- **Style Transfer**: Apply any artistic style to your images
- **Aspect Ratio Control**: Perfect sizing for social media, prints, and web
- **Bulk Generation**: Create multiple variations instantly
- **High Resolution Output**: Professional quality images up to 4K

### ğŸ® Interactive Features
- **Waiting Game**: Play Schulte Grid games while your images generate
- **Community Gallery**: Share and discover amazing AI artwork
- **Prompt Library**: Access thousands of tested prompts
- **Favorites System**: Save and organize your best creations

## ğŸš€ Getting Started

Visit [**aimagica.ai**](https://aimagica.ai) to start creating amazing AI art:

1. **Enter Your Prompt**: Describe what you want to create
2. **Choose Your Style**: Select from our curated art styles
3. **Generate**: Watch AI bring your vision to life
4. **Share & Save**: Download or share your masterpiece

## ğŸ¨ Use Cases

### Creative Professionals
- **Concept Art**: Rapid prototyping for games, films, and design
- **Marketing Materials**: Eye-catching visuals for campaigns
- **Social Media Content**: Engaging posts and stories
- **Book Illustrations**: Custom artwork for publications

### Personal Projects
- **Social Media**: Unique profile pictures and posts
- **Gifts**: Personalized artwork for loved ones
- **Home Decor**: Custom art prints for your space
- **Creative Exploration**: Experiment with different art styles

### Business Applications
- **Website Graphics**: Professional images for your site
- **Product Mockups**: Visualize ideas before production
- **Brand Assets**: Unique visual elements for your brand
- **Presentations**: Compelling visuals for pitches and reports

## ğŸ”¥ Popular Styles

- **ğŸï¸ Landscape Photography**: Breathtaking nature scenes
- **ğŸ‘¨â€ğŸ¨ Portrait Art**: Professional character illustrations
- **ğŸ° Fantasy Art**: Magical worlds and creatures
- **ğŸ¤– Sci-Fi Concepts**: Futuristic technology and scenes
- **ğŸŒ¸ Anime Style**: Japanese animation-inspired art
- **ğŸ­ Classical Art**: Renaissance and baroque masterpieces
- **ğŸŒˆ Pop Art**: Bold, colorful modern designs

## ğŸ’ Key Benefits

âœ… **No Design Skills Required** - Anyone can create professional art  
âœ… **Lightning Fast** - Generate images in seconds, not hours  
âœ… **Unlimited Creativity** - Explore any style or concept  
âœ… **High Quality Output** - Professional resolution and clarity  
âœ… **Cost Effective** - Affordable alternative to hiring artists  
âœ… **Commercial Use** - Full rights to your generated images  

## ğŸŒ Supported Platforms

- **ğŸ’» Desktop**: Full-featured web experience
- **ğŸ“± Mobile**: Optimized mobile interface
- **ğŸ“Š API Access**: Integrate AI generation into your apps
- **ğŸ”— Social Sharing**: Direct sharing to all major platforms

## ğŸ¯ SEO Keywords

**AI Image Generator** | **Text to Image AI** | **AI Art Creator** | **Artificial Intelligence Art** | **AI Photo Generator** | **Digital Art AI** | **AI Illustration Tool** | **Creative AI Platform** | **AI Design Assistant** | **Automated Art Creation**

## ğŸ“ Support & Community

- ğŸŒ **Website**: [aimagica.ai](https://aimagica.ai)
- ğŸ“§ **Support**: Create amazing art with our AI-powered platform
- ğŸ¨ **Gallery**: Explore community creations
- ğŸ“š **Tutorials**: Learn advanced generation techniques

## ğŸ† Why Choose Aimagica?

- **ğŸ¯ User-Friendly**: Intuitive interface for all skill levels
- **âš¡ Fast Generation**: Quick results without compromise on quality
- **ğŸ¨ Diverse Styles**: Largest collection of AI art styles
- **ğŸ’¡ Smart Features**: Advanced tools like sketch canvas and style mixing
- **ğŸŒŸ Regular Updates**: New features and styles added frequently
- **ğŸ”’ Privacy Focused**: Your creations remain private unless you choose to share

### R2 CDN éƒ¨ç½²çŠ¶æ€ âœ…
- **é™æ€èµ„æºCDN**: 15ä¸ªæ–‡ä»¶å·²ä¸Šä¼ åˆ°R2 (2.19MB)
- **CDNåŸŸå**: https://images.aimagica.ai
- **ä¸»è¦èµ„æº**: Logo (1021KB), èƒŒæ™¯å›¾ (1.2MB), ç¤ºä¾‹å›¾æ ‡ (4ä¸ª), å ä½ç¬¦ (9ä¸ª)

### ğŸš€ OpenNext.js éƒ¨ç½²é€‰é¡¹

é¡¹ç›®ç°åœ¨æ”¯æŒä½¿ç”¨OpenNext.jsè¿›è¡Œæ›´çµæ´»çš„äº‘éƒ¨ç½²ï¼š

#### ä»€ä¹ˆæ˜¯OpenNext.jsï¼Ÿ
OpenNext.jsæ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œå¯ä»¥å°†Next.jsåº”ç”¨è½¬æ¢ä¸ºå¯éƒ¨ç½²åˆ°å„ç§äº‘å¹³å°çš„åŒ…ï¼Œæä¾›ï¼š
- **æ›´å¥½çš„SSRæ”¯æŒ**: è§£å†³å¤æ‚çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“é—®é¢˜
- **å‡½æ•°åˆ†å‰²**: APIè·¯ç”±å’Œé¡µé¢è·¯ç”±ç‹¬ç«‹æ‰“åŒ…
- **äº‘å¹³å°å…¼å®¹**: æ”¯æŒAWS Lambdaã€Node.jsæœåŠ¡å™¨ç­‰
- **å†·å¯åŠ¨ä¼˜åŒ–**: å‡ ä¹æ²¡æœ‰å†·å¯åŠ¨æ—¶é—´

#### ğŸš€ æ–°ç‰ˆæœ¬æ„å»ºä¼˜åŒ– (2025-01-30)

**è§£å†³æ„å»ºæ—¶é—´é•¿å’Œè¶…æ—¶é—®é¢˜ï¼š**

```bash
# å®‰è£…ä¾èµ–
pnpm install

# ğŸš€ æç®€æ„å»º (æœ€å¿«é€Ÿåº¦) - è§£å†³è¶…æ—¶ï¼
pnpm build

# âš¡ è¶…å¿«é€Ÿæ„å»º (ä¿ç•™æ›´å¤šåŠŸèƒ½)
pnpm build:turbo

# ğŸƒ å¿«é€Ÿæ„å»º (ä¿ç•™ç¼“å­˜)
pnpm build:fast

# ğŸ§¹ å®Œæ•´æ¸…ç†æ„å»º (ç”Ÿäº§ç¯å¢ƒ)
pnpm build:clean

# è¾“å‡ºå°†åœ¨ .open-next/assets ç›®å½•ä¸­
```

**ğŸš€ æœ€æ–°æ„å»ºä¼˜åŒ–ç­–ç•¥ï¼ˆè§£å†³20åˆ†é’Ÿè¶…æ—¶ï¼‰ï¼š**
- âœ… **æç®€æ¨¡å¼**: å…³é—­æ‰€æœ‰ä¼˜åŒ–åŠŸèƒ½ï¼Œæœ€å¤§åŒ–æ„å»ºé€Ÿåº¦
- âœ… **ä¾èµ–ä¼˜åŒ–**: `--no-optional --prefer-offline` è·³è¿‡å¯é€‰åŒ…
- âœ… **Node.jsé”å®š**: ä½¿ç”¨ç¨³å®šç‰ˆæœ¬18.20.4
- âœ… **webpackæœ€å°åŒ–**: å…³é—­æºç æ˜ å°„å’Œæ€§èƒ½æ£€æŸ¥
- âœ… **é¢„æœŸæ—¶é—´**: 2-3åˆ†é’Ÿå®Œæˆï¼ˆvs ä¹‹å‰20åˆ†é’Ÿè¶…æ—¶ï¼‰

#### é…ç½®æ–‡ä»¶è¯´æ˜
- **`next.config.mjs`**: æ ‡å‡†é…ç½®ï¼ŒåŒ…å«å¤æ‚webpackä¼˜åŒ–ï¼ˆç”¨äºæœ¬åœ°å¼€å‘ï¼‰
- **`next.config.minimal.mjs`**: **ğŸš€ æç®€æ„å»ºé…ç½®**ï¼ˆå…³é—­æ‰€æœ‰ä¼˜åŒ–ï¼Œè§£å†³è¶…æ—¶ï¼‰
- **`next.config.fast.mjs`**: **âš¡ è¶…å¿«é€Ÿæ„å»ºé…ç½®**ï¼ˆç§»é™¤ä¼˜åŒ–ï¼Œæœ€å°ç¼–è¯‘æ­¥éª¤ï¼‰
- **`next.config.opennext.mjs`**: ç®€åŒ–é…ç½®ï¼Œç”¨äº OpenNext.js æ„å»ºï¼ˆæ”¯æŒ AWS å’Œ Cloudflareï¼‰
- **`cloudflare-build.sh`**: **â˜ï¸ Cloudflareä¸“ç”¨æ„å»ºè„šæœ¬**ï¼ˆä¼˜åŒ–ä¾èµ–å®‰è£…ï¼‰
- **`open-next.config.ts`**: OpenNext.js AWS éƒ¨ç½²é…ç½®  
- **`open-next.cloudflare.config.ts`**: **OpenNext.js Cloudflare ä¸“ç”¨é…ç½®**

#### ğŸ› ï¸ æ„å»ºé—®é¢˜æ’æŸ¥

**å¦‚æœé‡åˆ°æ„å»ºè¶…æ—¶ï¼š**
```bash
# 1. ä½¿ç”¨ç›‘æ§è„šæœ¬äº†è§£æ„å»ºè¿›åº¦
pnpm build:monitor "pnpm build:minimal"

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´å’Œå†…å­˜
df -h

# 3. æ¸…ç†å…¨éƒ¨ç¼“å­˜å’Œé‡è¯•
pnpm clean && pnpm build:minimal

# 4. å¦‚æœè¿˜è¶…æ—¶ï¼Œæ£€æŸ¥å…·ä½“å“ªä¸ªé˜¶æ®µæ…¢
tail -f build-monitor.log
```

**ğŸ”§ å·²ä¿®å¤çš„æ„å»ºé—®é¢˜ï¼š**
- âœ… **ç¯å¢ƒå˜é‡æ£€æŸ¥é”™è¯¯**ï¼š`supabaseKey is required` (æ„å»ºæ—¶ä¸åº”æ£€æŸ¥)
- âœ… **ä¾èµ–å®‰è£…ä¼˜åŒ–**ï¼šè·³è¿‡å¯é€‰ä¾èµ–ï¼Œä½¿ç”¨ç¦»çº¿ç¼“å­˜
- âœ… **webpacké…ç½®ç®€åŒ–**ï¼šå…³é—­æºç æ˜ å°„å’Œæ€§èƒ½æ£€æŸ¥
- âœ… **æ‡’åŠ è½½æ•°æ®åº“å®¢æˆ·ç«¯**ï¼šä»…åœ¨è¿è¡Œæ—¶åˆå§‹åŒ–
- âœ… **ğŸ†• æ ¸å¿ƒæœåŠ¡å™¨å‡½æ•°ä¿®å¤** (2025-01-30)ï¼šä¿®å¤ `lib/supabase-server.ts` ä¸­ `createServiceRoleClient()` ç­‰å‡½æ•°çš„æ„å»ºæ—¶ç¯å¢ƒå˜é‡æ£€æŸ¥é—®é¢˜
- âœ… **ğŸ†• Magic Coins æœåŠ¡ä¿®å¤**ï¼šå°† `MagicCoinService` æ”¹ä¸ºæ‡’åŠ è½½æ¨¡å¼ï¼Œé¿å…æ¨¡å—é¡¶å±‚ç«‹å³åˆ›å»ºå®¢æˆ·ç«¯
- âœ… **ğŸ†• Next.js 15 404é¡µé¢é”™è¯¯ä¿®å¤** (2025-07-01)ï¼š
  - é—®é¢˜ï¼š`Error: <Html> should not be imported outside of pages/_document`
  - åŸå› ï¼šæ··åˆä½¿ç”¨ App Router + Pages Router æ—¶ï¼ŒNext.js 15 åœ¨å¤„ç†404é¡µé¢æ—¶å‡ºç°å†²çª
  - è§£å†³æ–¹æ¡ˆï¼š
    1. åˆ é™¤ `pages/404.js` æ–‡ä»¶ï¼Œé¿å…ä¸å†…éƒ¨é”™è¯¯å¤„ç†å†²çª
    2. åˆ›å»º `app/not-found.tsx` æ–‡ä»¶ï¼Œæ­£ç¡®å¤„ç† App Router çš„ 404 é¡µé¢
    3. ä¿®æ”¹ `next.config.pages.mjs`ï¼Œç§»é™¤ appDir æ˜¾å¼é…ç½®å’Œ rewrites fallback
    4. è®© Next.js è‡ªåŠ¨å¤„ç†æ··åˆè·¯ç”±çš„ 404 é¡µé¢ç”Ÿæˆ
- âœ… **ğŸ†• å›¾ç‰‡åŠ è½½é—®é¢˜ä¿®å¤** (2025-07-01)ï¼š
  - é—®é¢˜ï¼šGalleryé¡µé¢å’Œé¦–é¡µHeroåŒºåŸŸå›¾ç‰‡æ— æ³•åŠ è½½
  - åŸå› ï¼šé”™è¯¯åœ°æ›¿æ¢äº† `MagicImage` ç»„ä»¶ä¸ºæ™®é€š `img` æ ‡ç­¾ï¼Œä¸¢å¤±äº†Next.jså›¾ç‰‡ä¼˜åŒ–ï¼›Galleryé¡µé¢ä½¿ç”¨ç¡¬ç¼–ç æ•°æ®è€ŒéAPIï¼›HeroSectionä½¿ç”¨é”™è¯¯çš„APIè·¯å¾„
  - è§£å†³æ–¹æ¡ˆï¼š
- âœ… **ğŸ†• æ¡Œé¢ç«¯å­—ä½“ä¼˜åŒ–ä¿®å¤** (2025-07-01)ï¼š
  - é—®é¢˜ï¼šæ¡Œé¢ç«¯æ‰€æœ‰å­—ä½“è¢«å¼ºåˆ¶è¦†ç›–ä¸ºFredoka Oneï¼Œå¯¼è‡´Style Managementé¡µé¢ç­‰å­—ä½“è¿‡ç²—ï¼Œå¯è¯»æ€§å·®ï¼›Styleå¡ç‰‡æè¿°æ–‡å­—é¢œè‰²è¿‡æµ…
  - åŸå› ï¼šglobals.cssä¸­çš„å¼ºåˆ¶å­—ä½“è¦†ç›–è§„åˆ™ + Admin Dashboardé¡µé¢å¤§é‡å†…è”å­—ä½“æ ·å¼ + æµ…è‰²æ–‡å­—é¢œè‰²(#8b7355)
  - è§£å†³æ–¹æ¡ˆï¼š
    1. æ¢å¤åŸå§‹å­—ä½“ç­–ç•¥ï¼šæ ‡é¢˜ä½¿ç”¨ç§‘æŠ€æ„Ÿå­—ä½“(Orbitron)ï¼Œæ­£æ–‡ä½¿ç”¨ç°ä»£å­—ä½“(Space Grotesk)
    2. ä»…å¯¹ç‰¹å®šé­”æ³•ä¸»é¢˜å…ƒç´ ä½¿ç”¨Fredoka Oneå­—ä½“(.font-magic, .hero-titleç­‰)
    3. **ç§»é™¤æ‰€æœ‰å†…è”å­—ä½“æ ·å¼**ï¼šä»Admin Dashboardé¡µé¢ç§»é™¤`style={{ fontFamily: "Fredoka One..." }}`
    4. **ä¼˜åŒ–æ–‡å­—é¢œè‰²å¯¹æ¯”åº¦**ï¼šå°†æµ…è‰²æ–‡å­—(#8b7355)æ”¹ä¸ºæ·±è‰²(#2d3e2d)ï¼Œæå‡å¯è¯»æ€§
    5. æ·»åŠ å¼ºåˆ¶CSSè§„åˆ™ç¡®ä¿Admin Dashboardå­—ä½“æ­£ç¡®åº”ç”¨
    6. ä¿ç•™Galleryé¡µé¢çš„Comic Sans MSè‰ºæœ¯é£æ ¼
    1. æ¢å¤ `MagicImage` ç»„ä»¶ä½¿ç”¨ï¼Œä¿æŒNext.jså›¾ç‰‡ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†
    2. æ¢å¤Galleryé¡µé¢å®Œæ•´APIè°ƒç”¨é€»è¾‘ï¼Œä»workersæ•°æ®åº“åŠ è½½çœŸå®å›¾ç‰‡
    3. ä¿®å¤HeroSectionç»„ä»¶APIè·¯å¾„ï¼Œä½¿ç”¨ `getApiEndpoint('GALLERY_PUBLIC')` è·å–æ­£ç¡®çš„workers API URL
    4. æ·»åŠ APIæ•°æ®æ ¼å¼è½¬æ¢ï¼Œç¡®ä¿å…¼å®¹ç°æœ‰æ¥å£
    5. ä¿æŒfallbackæœºåˆ¶ï¼ŒAPIå¤±è´¥æ—¶ä½¿ç”¨é™æ€ç¤ºä¾‹æ•°æ®

**æ„å»ºæ—¶é—´å¯¹æ¯”ï¼ˆè§£å†³20åˆ†é’Ÿè¶…æ—¶é—®é¢˜ï¼‰ï¼š**
- ğŸŒ `build:clean`: 8-12åˆ†é’Ÿ (å…¨æ¸…ç†)
- ğŸƒ `build:fast`: 5-8åˆ†é’Ÿ (ä¿ç•™ç¼“å­˜)  
- âš¡ `build:turbo`: 3-5åˆ†é’Ÿ (å…³é—­ä¼˜åŒ–)
- ğŸš€ `build:minimal`: **2-3åˆ†é’Ÿ** (æç®€æ¨¡å¼ï¼Œè§£å†³è¶…æ—¶)

#### æ„å»ºè¿‡ç¨‹
1. è‡ªåŠ¨å¤‡ä»½å½“å‰é…ç½®æ–‡ä»¶
2. åˆ‡æ¢åˆ°ç®€åŒ–çš„OpenNext.jså…¼å®¹é…ç½®
3. æ‰§è¡ŒNext.jsæ„å»º
4. è¿è¡ŒOpenNext.jsè½¬æ¢
5. æ¢å¤åŸå§‹é…ç½®æ–‡ä»¶

#### ğŸš€ Cloudflare Pages éƒ¨ç½²
**ä½¿ç”¨å®˜æ–¹æ¨èçš„ @opennextjs/cloudflare é€‚é…å™¨ï¼š**
```bash
pnpm build:cf
```
è¿™ä¸ªå‘½ä»¤ä¼šï¼š
1. æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
2. **è‡ªåŠ¨åˆ‡æ¢åˆ° OpenNext.js ç®€åŒ–é…ç½®**ï¼ˆ`next.config.opennext.mjs`ï¼‰
3. æ‰§è¡Œ Next.js æ„å»º
4. **ä½¿ç”¨ @opennextjs/cloudflare build** å‘½ä»¤è½¬æ¢ï¼ˆä¸“ä¸º Cloudflare ä¼˜åŒ–ï¼‰
5. è¾“å‡ºåˆ° `.open-next/assets` ç›®å½•
6. **æ¸…ç†ç¼“å­˜æ–‡ä»¶**ï¼šç§»é™¤ `.open-next/assets/cache` ç›®å½•é¿å…è¶…è¿‡25MBé™åˆ¶
7. **æ¢å¤åŸå§‹é…ç½®æ–‡ä»¶**

âœ… **ä¼˜åŠ¿ï¼š** 
- **å®˜æ–¹æ¨èçš„æ–¹å¼**ï¼ˆ2025å¹´4æœˆå‘å¸ƒï¼‰
- **æ”¯æŒ API è·¯ç”±å’Œ Node.js runtime**
- **ä¸“é—¨ä¸º Cloudflare Workers ä¼˜åŒ–**
- **é¿å…å¤æ‚çš„ webpack é…ç½®é—®é¢˜**

### ğŸ—ï¸ æ··åˆæ¶æ„éƒ¨ç½²ï¼ˆæ¨èï¼‰

**æœ€ä½³å®è·µï¼šCloudflare Workers (API) + Cloudflare Pages (å‰ç«¯)**

è¿™ç§æ¶æ„åˆ†ç¦»å‰åç«¯ï¼Œåˆ©ç”¨å„è‡ªçš„ä¼˜åŠ¿ï¼š

#### æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    APIè¯·æ±‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare Pagesâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚Cloudflare Workersâ”‚
â”‚                 â”‚                â”‚                  â”‚
â”‚ âœ… Next.jså‰ç«¯  â”‚                â”‚ âœ… 75ä¸ªAPIè·¯ç”±   â”‚
â”‚ âœ… é™æ€ä¼˜åŒ–     â”‚                â”‚ âœ… è¾¹ç¼˜è®¡ç®—      â”‚
â”‚ âœ… CDNåˆ†å‘      â”‚                â”‚ âœ… æ— æœåŠ¡å™¨      â”‚
â”‚ âœ… SEOå‹å¥½      â”‚                â”‚ âœ… ä½å»¶è¿Ÿ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸš€ ä¸€é”®éƒ¨ç½²
```bash
# æ··åˆæ¶æ„å®Œæ•´éƒ¨ç½²
pnpm deploy:hybrid
```

#### åˆ†æ­¥éƒ¨ç½²
```bash
# 1. éƒ¨ç½²APIåç«¯åˆ°Workers
pnpm deploy:api

# 2. éƒ¨ç½²å‰ç«¯åˆ°Pages
pnpm deploy:pages

# 3. æˆ–è€…åˆ†åˆ«æ„å»º
pnpm build:pages  # æ„å»ºå‰ç«¯é™æ€æ–‡ä»¶
pnpm build:workers # æ„å»ºWorkersï¼ˆå¦‚éœ€è¦ï¼‰
```

#### ğŸ”§ é…ç½®æ–‡ä»¶
| æ–‡ä»¶ | ç”¨é€” | ç‰¹ç‚¹ |
|------|------|------|
| `next.config.pages.mjs` | Pageså‰ç«¯é…ç½® | é™æ€å¯¼å‡ºã€CDNä¼˜åŒ– |
| `wrangler.api.toml` | API Workersé…ç½® | ä¸“æ³¨APIæœåŠ¡ |
| `workers/api-only.js` | API Workersä»£ç  | è½»é‡çº§ã€é«˜æ€§èƒ½ |

#### ğŸŒ éƒ¨ç½²ç»“æœ
- **å‰ç«¯**: https://aimagica.pages.dev  
- **APIåç«¯**: https://aimagica-api.403153162.workers.dev  
- **CDNèµ„æº**: https://images.aimagica.ai  

#### âœ… ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | å•ä½“Workers | **æ··åˆæ¶æ„** | å•ä½“Pages |
|------|-------------|-------------|-----------|
| å‰ç«¯æ€§èƒ½ | âš¡ ä¸­ç­‰ | ğŸš€ **æœ€ä¼˜** | âš¡ è‰¯å¥½ |
| APIæ€§èƒ½ | ğŸš€ æœ€ä¼˜ | ğŸš€ **æœ€ä¼˜** | âŒ å—é™ |
| SEOä¼˜åŒ– | âš¡ ä¸­ç­‰ | ğŸš€ **æœ€ä¼˜** | ğŸš€ ä¼˜ç§€ |
| ç¼“å­˜ç­–ç•¥ | âš¡ ä¸­ç­‰ | ğŸš€ **æœ€ä¼˜** | âš¡ è‰¯å¥½ |
| æ‰©å±•æ€§ | âš¡ ä¸­ç­‰ | ğŸš€ **æœ€ä¼˜** | âš¡ ä¸­ç­‰ |
| ç»´æŠ¤æ€§ | âš¡ ä¸­ç­‰ | ğŸš€ **æœ€ä¼˜** | âš¡ è‰¯å¥½ |

#### ğŸ”— APIä»£ç†é…ç½®
å‰ç«¯è‡ªåŠ¨ä»£ç†APIè¯·æ±‚åˆ°Workersï¼š
```javascript
// next.config.pages.mjs
async rewrites() {
  return [
    {
      source: '/api/:path*',
      destination: 'https://aimagica-api.403153162.workers.dev/api/:path*',
    },
  ]
}
```

#### ğŸ“Š ç¯å¢ƒå˜é‡é…ç½®
åœ¨Cloudflare Pagesä¸­è®¾ç½®ï¼š
```bash
NEXT_PUBLIC_API_BASE_URL=https://aimagica-api.403153162.workers.dev
NEXT_PUBLIC_CDN_URL=https://images.aimagica.ai
NODE_ENV=production
```

### ğŸ”§ è¯¦ç»†éƒ¨ç½²æŒ‡å—ï¼šCloudflare Pages + Workers æ··åˆæ¶æ„

#### ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

**1. éªŒè¯é…ç½®**
```bash
# æ£€æŸ¥æ‰€æœ‰é…ç½®æ–‡ä»¶æ˜¯å¦å°±ç»ª
pnpm verify:cloudflare
```

**2. å®‰è£… Wrangler CLI**
```bash
# å…¨å±€å®‰è£…
npm install -g wrangler

# æˆ–ä½¿ç”¨é¡¹ç›®ä¾èµ–
pnpm install

# ç™»å½• Cloudflare
wrangler login
```

#### ğŸ”¨ æ­¥éª¤1ï¼šéƒ¨ç½² Workers API

**é…ç½® Workers ç¯å¢ƒå˜é‡**

åœ¨ [Cloudflare Dashboard](https://dash.cloudflare.com) â†’ Workers & Pages â†’ aimagica-api â†’ Settings â†’ Variablesï¼š

```bash
# æ ¸å¿ƒé…ç½®
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_KEY=your_service_role_key
NEXTAUTH_SECRET=your_32_char_random_secret

# R2 å­˜å‚¨
R2_ACCESS_KEY_ID=your_r2_access_key
R2_SECRET_ACCESS_KEY=your_r2_secret_key
R2_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com
R2_BUCKET_NAME=aimagica-storage

# AI æœåŠ¡
KIEFLUX_API_KEY=your_kieflux_api_key
KIEFLUX_API_URL=https://api.kieflux.com

# æ”¯ä»˜é…ç½®
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_client_secret
```

**éƒ¨ç½² Workers**
```bash
# éƒ¨ç½² API Workers
pnpm deploy:workers

# æˆ–ä½¿ç”¨ wrangler ç›´æ¥éƒ¨ç½²
wrangler deploy --config wrangler.workers.toml
```

**è·å– Workers åŸŸå**
```bash
# éƒ¨ç½²æˆåŠŸåï¼Œè®°å½•æ˜¾ç¤ºçš„åŸŸå
âœ… https://aimagica-api.your-subdomain.workers.dev
```

#### ğŸ”¨ æ­¥éª¤2ï¼šéƒ¨ç½² Pages å‰ç«¯

**æ›´æ–° API åŸºç¡€ URL**

æ›´æ–° `next.config.pages.mjs` å’Œ `wrangler.pages.toml` ä¸­çš„ Workers åŸŸåï¼š

```javascript
// next.config.pages.mjs
env: {
  NEXT_PUBLIC_API_BASE_URL: 'https://aimagica-api.your-subdomain.workers.dev',
}

// wrangler.pages.toml
[[redirects]]
from = "/api/*"
to = "https://aimagica-api.your-subdomain.workers.dev/api/:splat"
```

**é…ç½® Pages ç¯å¢ƒå˜é‡**

åœ¨ Cloudflare Dashboard â†’ Pages â†’ aimagica-pages â†’ Settings â†’ Environment Variablesï¼š

```bash
# å‰ç«¯é…ç½®
NEXT_PUBLIC_API_BASE_URL=https://aimagica-api.your-subdomain.workers.dev
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
NEXT_PUBLIC_R2_PUBLIC_URL=https://images.aimagica.ai
NEXTAUTH_URL=https://aimagica.pages.dev
NEXTAUTH_SECRET=your_32_char_random_secret
NODE_ENV=production
```

**æ„å»ºå’Œéƒ¨ç½² Pages**
```bash
# æ„å»ºå‰ç«¯é™æ€æ–‡ä»¶
pnpm build:pages

# éƒ¨ç½²åˆ° Pages
pnpm deploy:pages

# æˆ–ä½¿ç”¨ wrangler ç›´æ¥éƒ¨ç½²
wrangler pages deploy out --project-name aimagica-pages
```

#### ğŸ”¨ æ­¥éª¤3ï¼šè¿æ¥æµ‹è¯•

**æµ‹è¯• API è¿æ¥**
```bash
# æµ‹è¯• Workers API
curl https://aimagica-api.your-subdomain.workers.dev/api/test

# åº”è¯¥è¿”å›
{"message":"Workers API is working!","timestamp":"..."}
```

**æµ‹è¯•å‰ç«¯**
```bash
# è®¿é—®å‰ç«¯ç½‘ç«™
open https://aimagica.pages.dev

# æ£€æŸ¥ API ä»£ç†æ˜¯å¦å·¥ä½œ
# æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network â†’ æŸ¥çœ‹ /api/ è¯·æ±‚æ˜¯å¦ä»£ç†åˆ° Workers
```

#### ğŸ”¨ æ­¥éª¤4ï¼šè‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

**è®¾ç½® Workers è‡ªå®šä¹‰åŸŸå**

1. åœ¨ Cloudflare Dashboard â†’ Workers & Pages â†’ aimagica-api â†’ Settings â†’ Triggers
2. æ·»åŠ è‡ªå®šä¹‰åŸŸåï¼š`api.yourdomain.com`
3. é…ç½® DNS è®°å½•ï¼ˆè‡ªåŠ¨ï¼‰

**è®¾ç½® Pages è‡ªå®šä¹‰åŸŸå**

1. åœ¨ Cloudflare Dashboard â†’ Pages â†’ aimagica-pages â†’ Custom domains
2. æ·»åŠ è‡ªå®šä¹‰åŸŸåï¼š`yourdomain.com`
3. é…ç½® DNS è®°å½•ï¼ˆè‡ªåŠ¨ï¼‰

**æ›´æ–°é…ç½®**
```bash
# æ›´æ–°ç¯å¢ƒå˜é‡
NEXT_PUBLIC_API_BASE_URL=https://api.yourdomain.com
NEXTAUTH_URL=https://yourdomain.com

# æ›´æ–°é‡å®šå‘é…ç½®
# wrangler.pages.toml
to = "https://api.yourdomain.com/api/:splat"
```

#### ğŸ” æ•…éšœæ’é™¤

**å¸¸è§é—®é¢˜1ï¼šAPI è·¯ç”± 404**
```bash
# æ£€æŸ¥ Workers éƒ¨ç½²çŠ¶æ€
wrangler tail aimagica-api

# æ£€æŸ¥è·¯ç”±é…ç½®
curl -v https://aimagica-api.your-subdomain.workers.dev/api/test
```

**å¸¸è§é—®é¢˜2ï¼šCORS é”™è¯¯**
```javascript
// æ£€æŸ¥ workers/api-worker.js ä¸­çš„ CORS é…ç½®
const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS, PATCH',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With',
}
```

**å¸¸è§é—®é¢˜3ï¼šç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ**
```bash
# é‡æ–°éƒ¨ç½² Workers
wrangler deploy --config wrangler.workers.toml

# é‡æ–°éƒ¨ç½² Pages
wrangler pages deploy out --project-name aimagica-pages --compatibility-date 2024-01-01
```

#### ğŸ“Š éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] âœ… Workers API éƒ¨ç½²æˆåŠŸ
- [ ] âœ… Pages å‰ç«¯éƒ¨ç½²æˆåŠŸ
- [ ] âœ… API åŸºç¡€ URL é…ç½®æ­£ç¡®
- [ ] âœ… ç¯å¢ƒå˜é‡å…¨éƒ¨è®¾ç½®
- [ ] âœ… CORS é…ç½®æ­£ç¡®
- [ ] âœ… æµ‹è¯• API è¿æ¥æˆåŠŸ
- [ ] âœ… å‰ç«¯å¯ä»¥è°ƒç”¨ API
- [ ] âœ… ç”¨æˆ·è®¤è¯æ­£å¸¸
- [ ] âœ… å›¾ç‰‡ä¸Šä¼ /æ˜¾ç¤ºæ­£å¸¸
- [ ] âœ… æ”¯ä»˜åŠŸèƒ½æ­£å¸¸ï¼ˆå¦‚æœå¯ç”¨ï¼‰

#### ğŸš€ ä¸€é”®éƒ¨ç½²è„šæœ¬

**å®Œæ•´éƒ¨ç½²æµç¨‹**
```bash
# 1. éªŒè¯é…ç½®
pnpm verify:cloudflare

# 2. éƒ¨ç½²æ‰€æœ‰æœåŠ¡
pnpm deploy:cloudflare

# 3. ç›‘æ§éƒ¨ç½²çŠ¶æ€
pnpm tail:workers
```

#### OpenNext.js é€‚é…å™¨é€‰æ‹©
- **`@opennextjs/cloudflare`** â†’ **Cloudflare Pages/Workers** ï¼ˆå®˜æ–¹æ¨èï¼Œä½¿ç”¨ `pnpm build:cf`ï¼‰
- **`@opennextjs/aws`** â†’ **AWS Lambda** ï¼ˆä½¿ç”¨ `pnpm build:opennext`ï¼‰
- ä¸¤è€…éƒ½æ”¯æŒå®Œæ•´çš„ Next.js åŠŸèƒ½ï¼ˆAPI è·¯ç”±ã€SSRã€Node.js runtime ç­‰ï¼‰
- **2025å¹´æ›´æ–°ï¼š** Cloudflare å®˜æ–¹æ¨èä½¿ç”¨ OpenNext.js è€Œä¸æ˜¯ next-on-pages

#### âš ï¸ æ³¨æ„äº‹é¡¹
- OpenNext.jsæ„å»ºä¼šè‡ªåŠ¨ä½¿ç”¨ç®€åŒ–é…ç½®ï¼Œé¿å…webpackå†²çª
- æ„å»ºå®Œæˆåä¼šè‡ªåŠ¨æ¢å¤åŸå§‹é…ç½®æ–‡ä»¶
- å¦‚æœæ„å»ºå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ¢å¤é…ç½®ï¼š`mv next.config.mjs.backup next.config.mjs`

#### ğŸ”§ å¸¸è§æ„å»ºé—®é¢˜

**âœ… æœ€æ–°ä¿®å¤ï¼ˆ2025-01-30ï¼‰ï¼šSupabaseå®¢æˆ·ç«¯æ„å»ºæ—¶åˆå§‹åŒ–é”™è¯¯**
```
Error: Supabase environment variables are not configured
    at createFastServiceRoleClient (.next/server/chunks/7706.js:36:7629)
    at new MagicCoinService (.next/server/app/api/magic-coins/balance/route.js:1:4699)
Failed to collect page data for /api/magic-coins/balance
```
**é—®é¢˜åŸå› ï¼š** 
1. `lib/supabase-server.ts` ä¸­çš„ `createServiceRoleClient()` ç­‰å‡½æ•°åœ¨æ„å»ºæ—¶ç«‹å³æ£€æŸ¥ç¯å¢ƒå˜é‡
2. `MagicCoinService` ç±»åœ¨æ¨¡å—é¡¶å±‚å°±åˆ›å»º Supabase å®¢æˆ·ç«¯
3. Next.js æ„å»ºæ—¶é¢„åŠ è½½æ¨¡å—è§¦å‘ç¯å¢ƒå˜é‡æ£€æŸ¥ï¼Œä½†æ„å»ºç¯å¢ƒæ²¡æœ‰çœŸå®å‡­æ®

**è§£å†³æ–¹æ¡ˆï¼š**
1. âœ… **ä¿®å¤æ ¸å¿ƒæœåŠ¡å™¨å‡½æ•°**ï¼šåœ¨ `lib/supabase-server.ts` ä¸­æ·»åŠ æ„å»ºæ—¶å ä½ç¬¦é€»è¾‘
2. âœ… **æ‡’åŠ è½½æ¨¡å¼**ï¼šå°† `MagicCoinService` çš„ Supabase å®¢æˆ·ç«¯æ”¹ä¸º getter å±æ€§æ‡’åŠ è½½
3. âœ… **ç¯å¢ƒæ£€æŸ¥ä¼˜åŒ–**ï¼šæ„å»ºæ—¶ä½¿ç”¨å ä½ç¬¦ï¼Œç”Ÿäº§è¿è¡Œæ—¶æ‰è¿›è¡Œä¸¥æ ¼æ£€æŸ¥
4. âœ… **æ¶‰åŠæ–‡ä»¶**ï¼š`lib/supabase-server.ts`, `lib/magic-coins.ts`, 8ä¸ªAPIè·¯ç”±æ–‡ä»¶

**âœ… è·¨å¹³å°å…¼å®¹æ€§é—®é¢˜**
```
sh: 1: powershell: not found
ELIFECYCLE Command failed with exit code 1
```
**é—®é¢˜åŸå› ï¼š** Windows ç‰¹å®šçš„ PowerShell å‘½ä»¤åœ¨ Linux æ„å»ºç¯å¢ƒä¸­å¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š** 
1. âœ… **ä¿®å¤ clean è„šæœ¬**ï¼š`powershell -Command` â†’ `rm -rf` (Linux å…¼å®¹)
2. âœ… **ä¿®å¤ Windows å‘½ä»¤**ï¼š`copy`/`move` â†’ `cp`/`mv`
3. âœ… **ç»Ÿä¸€æ„å»ºæµç¨‹**ï¼šé»˜è®¤ `pnpm build` ç°åœ¨ä½¿ç”¨ OpenNext.js Cloudflare æ„å»º
4. âœ… **æ‰€æœ‰è„šæœ¬ç°åœ¨è·¨å¹³å°å…¼å®¹**ï¼šæ”¯æŒ Windows å¼€å‘ + Linux äº‘æ„å»º

**OpenNext.js CLI å‘½ä»¤é”™è¯¯ï¼š**
```
Error: Error: invalid command, expected 'build' | 'preview' | 'deploy' | 'upload' | 'populateCache'
```
**è§£å†³æ–¹æ¡ˆï¼š** ä¿®å¤ `package.json` ä¸­çš„æ„å»ºå‘½ä»¤ï¼Œæ·»åŠ  `build` å‚æ•°ï¼š
```bash
npx @opennextjs/cloudflare build -c open-next.cloudflare.config.ts
```

**OpenNext.js Cloudflare é…ç½®æ ¼å¼é”™è¯¯ï¼š**
```
Error: The `open-next.config.ts` should have a default export like this:
```
**è§£å†³æ–¹æ¡ˆ1ï¼š** ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å `open-next.config.ts`ï¼ˆOpenNext.js é»˜è®¤æŸ¥æ‰¾æ­¤æ–‡ä»¶ï¼Œå³ä½¿æŒ‡å®šäº† `-c` å‚æ•°ä¹Ÿå¯èƒ½å¿½ç•¥ï¼‰
**è§£å†³æ–¹æ¡ˆ2ï¼š** ä½¿ç”¨æ­£ç¡®çš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼ˆä¸èƒ½æœ‰TypeScript importæˆ–ç±»å‹å®šä¹‰ï¼‰ï¼š
```typescript
export default {
  default: {
    override: {
      wrapper: "cloudflare-node",
      converter: "edge",
      proxyExternalRequest: "fetch",
      incrementalCache: "dummy",
      tagCache: "dummy",
      queue: "dummy",
    },
  },
  edgeExternals: ["node:crypto"],
  middleware: {
    external: true,
    override: {
      wrapper: "cloudflare-edge",
      converter: "edge",
      proxyExternalRequest: "fetch",
      incrementalCache: "dummy",
      tagCache: "dummy",
      queue: "dummy",
    },
  },
}
```
**æ³¨æ„ï¼š** é…ç½®æ–‡ä»¶å¿…é¡»æ˜¯çº¯JavaScriptå¯¹è±¡å¯¼å‡ºï¼Œä¸èƒ½åŒ…å«TypeScript importè¯­å¥æˆ–ç±»å‹å®šä¹‰ã€‚

**å›¾ç‰‡ä¼˜åŒ–é”™è¯¯ï¼ˆOpenNext.jsï¼‰ï¼š**
```
ERROR: Could not resolve "../overrides/imageLoader/custom.js"
```
**è§£å†³æ–¹æ¡ˆï¼š** å·²åœ¨ `open-next.config.ts` ä¸­è®¾ç½® `imageOptimization: false` ç¦ç”¨å›¾ç‰‡ä¼˜åŒ–ï¼Œå› ä¸ºé¡¹ç›®ä½¿ç”¨ `unoptimized: true` é…ç½®ã€‚

**æ–‡ä»¶å¤§å°é™åˆ¶é”™è¯¯ï¼ˆCloudflare Pagesï¼‰ï¼š**
```
ERROR: Pages only supports files up to 25 MiB in size
cache/webpack/server-production/0.pack is 156 MiB in size
```
**åŸå› åˆ†æï¼š** 
- å¤æ‚çš„ webpack é…ç½®ï¼ˆexternalsã€ä»£ç åˆ†å‰²ç­‰ï¼‰å¯¼è‡´å·¨å¤§çš„ç¼“å­˜æ–‡ä»¶
- Next.js 15.2.4 ä¸å¤æ‚é…ç½®å†²çª

**è§£å†³æ–¹æ¡ˆï¼š** 
1. ä½¿ç”¨ `pnpm build:cf` - **è‡ªåŠ¨ä½¿ç”¨è¶…ç®€åŒ–é…ç½®**ï¼ˆ`next.config.cf.mjs`ï¼‰
2. ç§»é™¤æ‰€æœ‰å¤æ‚çš„ webpack é…ç½®ï¼Œè®© Next.js ä½¿ç”¨é»˜è®¤é…ç½®
3. æ„å»ºè„šæœ¬ä¼šè‡ªåŠ¨æ¸…ç†æ‰€æœ‰ webpack ç¼“å­˜æ–‡ä»¶

**Webpack æ„å»ºé”™è¯¯ï¼ˆNext.js 15.2.4ï¼‰ï¼š**
```
HookWebpackError: _webpack.WebpackError is not a constructor
TypeError: _webpack.WebpackError is not a constructor
```
**è§£å†³æ–¹æ¡ˆï¼š** 
1. **æ ¹æœ¬æ€§ä¿®å¤**ï¼šåˆ›å»ºä¸“ç”¨çš„ `next.config.cf.mjs` è¶…ç®€åŒ–é…ç½®
2. ç§»é™¤æ‰€æœ‰å¯èƒ½å¯¼è‡´å†²çªçš„å¤æ‚ webpack é…ç½®
3. `pnpm build:cf` ä¼šè‡ªåŠ¨ä½¿ç”¨ç®€åŒ–é…ç½®ï¼Œé¿å…æ„å»ºé”™è¯¯

**404 é¡µé¢é”™è¯¯ï¼ˆCloudflare Pagesï¼‰ï¼š**
```
è®¿é—®ç½‘ç«™æ—¶æ˜¾ç¤º 404 é”™è¯¯
```
**è§£å†³æ–¹æ¡ˆï¼š** 
1. ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•æœ‰ `public/_routes.json` æ–‡ä»¶ï¼ˆå·²åŒ…å«ï¼‰
2. è¯¥æ–‡ä»¶é…ç½®äº†æ­£ç¡®çš„è·¯ç”±å¤„ç†è§„åˆ™ï¼Œå‘Šè¯‰ Cloudflare Pages å¦‚ä½•å¤„ç† API è·¯ç”±å’Œé™æ€èµ„æº

**å…³é”®å‘ç°ï¼šCloudflare Pages vs Workers é…ç½®å†²çª**
```
A wrangler.toml file was found but it does not appear to be valid.
Error: Pages only supports files up to 25 MiB in size
```

**é—®é¢˜æ ¹æºï¼š** `@opennextjs/cloudflare` ä¸“ä¸º **Cloudflare Workers** è®¾è®¡ï¼Œä½†ä½ å½“å‰åœ¨ **Cloudflare Pages** ç¯å¢ƒä¸­ï¼

**ğŸš€ è§£å†³æ–¹æ¡ˆï¼šé€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹å¼**

**é€‰é¡¹1ï¼šç»§ç»­ä½¿ç”¨ Cloudflare Pagesï¼ˆæ¨èä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼‰**
```bash
# ä½¿ç”¨æ ‡å‡† Next.js æ„å»ºï¼ˆæ—  OpenNext.jsï¼‰
pnpm build:cf-pages
```
- âœ… é¿å… webpack ç¼“å­˜é—®é¢˜
- âœ… å…¼å®¹å½“å‰ Pages ç¯å¢ƒ  
- âŒ æ— æ³•ä½¿ç”¨ OpenNext.js çš„ SSR ä¼˜åŒ–

**é€‰é¡¹2ï¼šåˆ‡æ¢åˆ° Cloudflare Workersï¼ˆæ¨èé•¿æœŸè§£å†³æ–¹æ¡ˆï¼‰**
```bash
# ä½¿ç”¨ OpenNext.js æ„å»ºï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰
pnpm build:cf-workers
```
- âœ… å®Œæ•´çš„ OpenNext.js åŠŸèƒ½
- âœ… æ›´å¥½çš„ SSR å’Œ API è·¯ç”±æ”¯æŒ
- âœ… Node.js runtime å…¼å®¹æ€§
- âš ï¸ éœ€è¦åˆ‡æ¢åˆ° Workers éƒ¨ç½²ç¯å¢ƒ

**é…ç½®æ–‡ä»¶è¯´æ˜ï¼š**
- `wrangler.toml` â†’ Cloudflare Pages é…ç½®
- `wrangler.workers.toml` â†’ Cloudflare Workers é…ç½®  
- `wrangler.pages.toml` â†’ Pages ä¸“ç”¨é…ç½®ï¼ˆå¤‡ç”¨ï¼‰

**ğŸš€ Next.js 15 App Router + é™æ€å¯¼å‡º 404 é¡µé¢é”™è¯¯ï¼š**
```
Error: <Html> should not be imported outside of pages/_document.
Error occurred prerendering page "/404"
Export encountered an error on /_error: /404, exiting the build.
```
**é—®é¢˜åŸå› ï¼š** Next.js 15 åœ¨ App Router + é™æ€å¯¼å‡ºæ¨¡å¼ä¸‹ï¼Œ`trailingSlash: true` é…ç½®ä¼šå¯¼è‡´404é¡µé¢é¢„æ¸²æŸ“å¤±è´¥

**âœ… è§£å†³æ–¹æ¡ˆï¼ˆå·²ä¿®å¤ï¼‰ï¼š**
```javascript
// next.config.pages.mjs
const nextConfig = {
  output: 'export',
  // ç§»é™¤å¯¼è‡´404é¡µé¢é”™è¯¯çš„é…ç½®
  // trailingSlash: true,
  skipTrailingSlashRedirect: true,  // æ·»åŠ æ­¤é…ç½®ä¼˜åŒ–è·¯ç”±å¤„ç†
  distDir: 'out',
  // ... å…¶ä»–é…ç½®
}
```

**ğŸ‰ æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼ˆ2025-01-30 å®Œå…¨ä¿®å¤ï¼‰ï¼š**
```javascript
// å…³é”®ä¿®å¤ç»„åˆ - å½»åº•è§£å†³ Html ç»„ä»¶å¯¼å…¥é”™è¯¯ï¼š
1. âŒ åˆ é™¤ app/not-found.tsx - é¿å…åŠ¨æ€é”™è¯¯é¡µé¢å†²çª
2. âŒ åˆ é™¤ app/error.tsx - ç§»é™¤è‡ªå®šä¹‰é”™è¯¯å¤„ç†  
3. âœ… åˆ›å»º public/404.html - çº¯é™æ€404é¡µé¢ï¼ˆç¾è§‚è®¾è®¡ï¼‰
4. âœ… ä¿ç•™ pages/_document.js - æä¾›æ­£ç¡®çš„ Html ç»„ä»¶å¯¼å…¥ä½ç½®
5. âœ… ç®€åŒ– next.config.pages.mjs - ç§»é™¤ exportPathMap ç­‰å¤æ‚é…ç½®
6. âœ… æ··åˆæ¶æ„ï¼šApp Router (ä¸»è¦) + Pages Router (ä»…_document.js)
```

**âœ… ä¿®å¤ç»“æœï¼š**
- ğŸš€ **88/88 é™æ€é¡µé¢æˆåŠŸç”Ÿæˆ**
- ğŸš€ **å®Œå…¨æ²¡æœ‰ Html å¯¼å…¥é”™è¯¯**
- ğŸš€ **Next.js 15 + App Router + é™æ€å¯¼å‡ºå®Œå…¨å…¼å®¹**
- ğŸš€ **æœ¬åœ°æ„å»ºæµ‹è¯•é€šè¿‡ï¼Œåº”è¯¥èƒ½åœ¨ Cloudflare Pages æˆåŠŸæ„å»º**

**é‡è¦å‘ç°ï¼š** Next.js 15 åœ¨é™æ€å¯¼å‡ºæ¨¡å¼ä¸‹ï¼Œå†…éƒ¨ä»ä¼šå°è¯•ä½¿ç”¨ Pages Router çš„ Html ç»„ä»¶ï¼Œä½†æ‰¾ä¸åˆ°æ­£ç¡®çš„å¯¼å…¥ä½ç½®ã€‚é€šè¿‡åˆ›å»º `pages/_document.js` æä¾›å¯¼å…¥æºï¼ŒåŒæ—¶åˆ é™¤å¯èƒ½å†²çªçš„è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼Œå®ç°äº†å®Œç¾å…¼å®¹ã€‚

**ğŸš€ 25MBæ–‡ä»¶å¤§å°é™åˆ¶è§£å†³æ–¹æ¡ˆï¼š**
```
Error: Pages only supports files up to 25 MiB in size
cache/webpack/client-production/0.pack is 123 MiB in size
```
**è§£å†³æ–¹æ¡ˆï¼š** ç¡®ä¿è¾“å‡ºç›®å½•é…ç½®æ­£ç¡®ä¸”æ¸…ç†ç¼“å­˜æ–‡ä»¶ï¼š
1. **æ­£ç¡®çš„è¾“å‡ºç›®å½•**ï¼š`pages_build_output_dir = ".open-next/assets"`ï¼ˆä¸æ˜¯`.next`ï¼‰
2. **è‡ªåŠ¨ç¼“å­˜æ¸…ç†**ï¼šæ„å»ºå‘½ä»¤ä¼šè‡ªåŠ¨æ¸…ç† `.open-next/assets/cache` ç›®å½•
3. **éªŒè¯æ–¹æ³•**ï¼šæ£€æŸ¥ `wrangler.toml` ä¸­çš„ `pages_build_output_dir` è®¾ç½®

### ğŸ“¦ éƒ¨ç½²åå›¾ç‰‡æ— æ³•åŠ è½½ï¼Ÿ

å¦‚æœéƒ¨ç½²åå›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š

#### 1. æ£€æŸ¥Cloudflare Pagesç¯å¢ƒå˜é‡
åœ¨Cloudflare Dashboard â†’ ä½ çš„é¡¹ç›® â†’ Settings â†’ Environment variables ä¸­ç¡®ä¿è®¾ç½®ï¼š

```bash
NEXT_PUBLIC_ENABLE_CDN=true
NEXT_PUBLIC_CDN_BASE_URL=https://images.aimagica.ai
NODE_ENV=production
```

#### 2. éªŒè¯CDNçŠ¶æ€
- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Networkæ ‡ç­¾
- åˆ·æ–°é¡µé¢ï¼Œå›¾ç‰‡è¯·æ±‚åº”è¯¥æŒ‡å‘ `images.aimagica.ai` è€Œä¸æ˜¯æœ¬åœ°è·¯å¾„
- æ§åˆ¶å°åº”æ˜¾ç¤ºï¼š`ğŸ“¦ Loaded static URL mapping: 15 files`

#### 3. å¸¸è§é—®é¢˜
| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| å›¾ç‰‡404 | ç¯å¢ƒå˜é‡æœªè®¾ç½® | è®¾ç½®`NEXT_PUBLIC_ENABLE_CDN=true` |
| æ˜¾ç¤ºæœ¬åœ°è·¯å¾„ | CDNæœªå¯ç”¨ | è®¾ç½®`NEXT_PUBLIC_CDN_BASE_URL` |
| æ§åˆ¶å°æ— æ—¥å¿— | æ˜ å°„æ–‡ä»¶æœªåŠ è½½ | æ£€æŸ¥`/static-urls.json`æ˜¯å¦å­˜åœ¨ |

è¯¦ç»†éƒ¨ç½²æŒ‡å—ï¼š[CLOUDFLARE_PAGES_SETUP.md](./CLOUDFLARE_PAGES_SETUP.md)

### ğŸš€ Vercel éƒ¨ç½²ï¼ˆæ¨èï¼‰

**å…¨åŠŸèƒ½éƒ¨ç½²åˆ° Vercel å¹³å°ï¼Œæ”¯æŒæ‰€æœ‰åŠŸèƒ½åŒ…æ‹¬ API è·¯ç”±ã€æ”¯ä»˜ç³»ç»Ÿã€ç”¨æˆ·è®¤è¯ç­‰ã€‚**

#### ğŸ¯ ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | Vercel | Cloudflare | 
|------|--------|------------|
| éƒ¨ç½²éš¾åº¦ | ğŸŸ¢ **æœ€ç®€å•** | ğŸŸ¡ ä¸­ç­‰ |
| API è·¯ç”±æ”¯æŒ | ğŸŸ¢ **åŸç”Ÿæ”¯æŒ** | ğŸŸ¡ éœ€é…ç½® |
| æ–‡ä»¶å¤§å°é™åˆ¶ | ğŸŸ¢ **250MB** | ğŸ”´ 25MB |
| æ„å»ºæ—¶é—´ | ğŸŸ¢ **å¿«é€Ÿ** | ğŸŸ¡ ä¸­ç­‰ |
| Next.js å…¼å®¹æ€§ | ğŸŸ¢ **å®Œç¾** | ğŸŸ¡ éœ€é€‚é… |
| å…è´¹é¢åº¦ | ğŸŸ¢ **æ…·æ…¨** | ğŸŸ¢ å……è¶³ |
| å…¨çƒCDN | ğŸŸ¢ ä¼˜ç§€ | ğŸŸ¢ **æœ€ä½³** |

#### ğŸš€ ä¸€é”®éƒ¨ç½²

**æ–¹å¼1ï¼šGitHub è¿æ¥ï¼ˆæ¨èï¼‰**
1. Fork æ­¤ä»“åº“åˆ°ä½ çš„ GitHub
2. åœ¨ [Vercel Dashboard](https://vercel.com/dashboard) ç‚¹å‡» "New Project"
3. å¯¼å…¥ä½ çš„ GitHub ä»“åº“
4. Vercel ä¼šè‡ªåŠ¨æ£€æµ‹ Next.js é¡¹ç›®å¹¶é…ç½®
5. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè§ä¸‹æ–¹ï¼‰
6. ç‚¹å‡» "Deploy" å¼€å§‹éƒ¨ç½²

**æ–¹å¼2ï¼šVercel CLI éƒ¨ç½²**
```bash
# å®‰è£…ä¾èµ–
pnpm install

# å®‰è£… Vercel CLI
pnpm add -D vercel

# ç™»å½• Vercel
pnpm vercel login

# é¢„è§ˆéƒ¨ç½²ï¼ˆæµ‹è¯•ï¼‰
pnpm preview:vercel

# ç”Ÿäº§éƒ¨ç½²
pnpm deploy:vercel
```

#### ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

**å¿…éœ€é…ç½®**ï¼ˆå‚è€ƒ [`env.vercel.template`](./env.vercel.template)ï¼‰ï¼š

åœ¨ Vercel Dashboard â†’ é¡¹ç›®è®¾ç½® â†’ Environment Variables ä¸­æ·»åŠ ï¼š

```bash
# ğŸ”´ æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…éœ€ï¼‰
NEXT_PUBLIC_SUPABASE_URL=https://vvrkbpnnlxjqyhmmovro.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

NEXTAUTH_SECRET=your_32_char_random_secret
NEXTAUTH_URL=https://your-domain.vercel.app

GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

KIE_AI_API_KEY=your_kie_ai_api_key
KIE_AI_BASE_URL=https://api.kie.ai

# ğŸŸ¡ æ”¯ä»˜åŠŸèƒ½ï¼ˆå•†ä¸šéœ€è¦ï¼‰
STRIPE_PUBLISHABLE_KEY=pk_live_your_stripe_key
STRIPE_SECRET_KEY=sk_live_your_stripe_secret
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# ğŸŸ¢ å­˜å‚¨åŠŸèƒ½ï¼ˆæ¨èï¼‰
CLOUDFLARE_ACCOUNT_ID=your_cloudflare_account_id
CLOUDFLARE_ACCESS_KEY_ID=your_access_key
CLOUDFLARE_SECRET_ACCESS_KEY=your_secret_key
NEXT_PUBLIC_R2_PUBLIC_URL=https://images.aimagica.ai
```

#### ğŸ”¨ æ„å»ºé…ç½®

é¡¹ç›®å·²é¢„é…ç½® Vercel ä¼˜åŒ–ï¼š
- **`next.config.vercel.mjs`**: Vercel ä¸“ç”¨é…ç½®
- **`vercel.json`**: éƒ¨ç½²ä¼˜åŒ–è®¾ç½®
- **`package.json`**: æ·»åŠ  `build:vercel` è„šæœ¬

**æ„å»ºå‘½ä»¤**ï¼š`pnpm build:vercel`  
**è¾“å‡ºç›®å½•**ï¼š`.next`  
**Node.js ç‰ˆæœ¬**ï¼š18.xï¼ˆæ¨èï¼‰

#### ğŸŒ åŸŸåé…ç½®

**è‡ªå®šä¹‰åŸŸåè®¾ç½®**ï¼š
1. åœ¨ Vercel Dashboard â†’ é¡¹ç›® â†’ Settings â†’ Domains
2. æ·»åŠ ä½ çš„åŸŸåï¼ˆå¦‚ `aimagica.com`ï¼‰
3. æ ¹æ®æç¤ºé…ç½® DNS è®°å½•
4. æ›´æ–°ç¯å¢ƒå˜é‡ `NEXTAUTH_URL` ä¸ºæ–°åŸŸå
5. æ›´æ–° Google OAuth é‡å®šå‘ URI

#### ğŸ”— Webhook é…ç½®

**Stripe Webhook**ï¼š
```
URL: https://your-domain.vercel.app/api/payment/webhooks/stripe
Events: payment_intent.succeeded, checkout.session.completed
```

**PayPal Webhook**ï¼š
```
URL: https://your-domain.vercel.app/api/payment/webhooks/paypal
Events: CHECKOUT.ORDER.APPROVED, PAYMENT.CAPTURE.COMPLETED
```

#### ğŸ“Š æ€§èƒ½ä¼˜åŒ–

Vercel è‡ªåŠ¨æä¾›ï¼š
- **è¾¹ç¼˜å‡½æ•°**ï¼šå…¨çƒä½å»¶è¿Ÿ API å“åº”
- **å›¾ç‰‡ä¼˜åŒ–**ï¼šè‡ªåŠ¨ WebP/AVIF è½¬æ¢
- **ç¼“å­˜ä¼˜åŒ–**ï¼šæ™ºèƒ½é™æ€èµ„æºç¼“å­˜
- **åˆ†æç›‘æ§**ï¼šå®æ—¶æ€§èƒ½ç›‘æ§

#### ğŸ› å¸¸è§é—®é¢˜è§£å†³

**æ„å»ºå¤±è´¥ - ç¯å¢ƒå˜é‡é”™è¯¯**ï¼š
```
Error: Supabase environment variables are not configured
```
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿åœ¨ Vercel ä¸­è®¾ç½®äº†æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡

**API è·¯ç”±è¶…æ—¶**ï¼š
```
Function execution timed out after 60 seconds
```
**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ `vercel.json` ä¸­å·²é…ç½®æ›´é•¿çš„è¶…æ—¶æ—¶é—´ï¼ˆå›¾åƒç”Ÿæˆ 300 ç§’ï¼‰

**å›¾ç‰‡æ— æ³•åŠ è½½**ï¼š
```
Image optimization using the default loader is not compatible with export
```
**è§£å†³æ–¹æ¡ˆï¼š** å·²åœ¨ `next.config.vercel.mjs` ä¸­é…ç½® `unoptimized: false`ï¼ŒVercel ä¼šå¤„ç†å›¾ç‰‡ä¼˜åŒ–

#### ğŸ”„ éƒ¨ç½²æ›´æ–°

**è‡ªåŠ¨éƒ¨ç½²**ï¼š
- æ¨é€åˆ° `main` åˆ†æ”¯è‡ªåŠ¨è§¦å‘ç”Ÿäº§éƒ¨ç½²
- æ¨é€åˆ°å…¶ä»–åˆ†æ”¯åˆ›å»ºé¢„è§ˆéƒ¨ç½²

**æ‰‹åŠ¨éƒ¨ç½²**ï¼š
```bash
# ä»æœ¬åœ°éƒ¨ç½²
pnpm deploy:vercel

# å¼ºåˆ¶é‡æ–°éƒ¨ç½²
vercel --prod --force
```

#### ğŸ’° æˆæœ¬ä¼°ç®—

**Vercel Pro è®¡åˆ’**ï¼ˆé€‚åˆç”Ÿäº§ä½¿ç”¨ï¼‰ï¼š
- æœˆè´¹ï¼š$20/month
- åŒ…å«ï¼š100GB å¸¦å®½ï¼Œ100GB è¾¹ç¼˜è¯·æ±‚
- å‡½æ•°æ‰§è¡Œï¼š1000 å°æ—¶/month
- é€‚åˆä¸­å°å‹ AI å›¾åƒç”Ÿæˆå¹³å°

---

## ğŸ¨ æœ€æ–°æ›´æ–°æ—¥å¿—

### ğŸ­ Galleryé¡µé¢æ ·å¼æ¢å¤ (2025-01-30)

**é—®é¢˜ï¼š** Galleryé¡µé¢çš„æ ·å¼å˜å¾—è¿‡äºç°ä»£åŒ–å’Œå•†ä¸šåŒ–ï¼Œå¤±å»äº†åŸæœ‰çš„è‰ºæœ¯æ„Ÿå’Œé­”æ³•ä¸»é¢˜

**æ¢å¤å†…å®¹ï¼š**
- âœ¨ **è‰ºæœ¯é£æ ¼æ¢å¤**ï¼š
  - ğŸ¨ **é»‘è‰²èƒŒæ™¯** + é‡‘è‰²ä¸»é¢˜è‰² (`#d4a574`)
  - ğŸ–‹ï¸ **Comic Sans MSå­—ä½“**ï¼Œè¥é€ æ‰‹ç»˜è‰ºæœ¯æ„Ÿ
  - ğŸ­ **æ—‹è½¬å˜æ¢æ•ˆæœ**ï¼Œæ¯ä¸ªå›¾ç‰‡å¡ç‰‡éƒ½æœ‰è½»å¾®å€¾æ–œ
  - ğŸª **ä¸è§„åˆ™è¾¹æ¡†å’Œé˜´å½±**ï¼Œå¢å¼ºè‰ºæœ¯æ„Ÿ

- ğŸ–¼ï¸ **ç€‘å¸ƒæµå¸ƒå±€ä¼˜åŒ–**ï¼š
  - ğŸ“± **å“åº”å¼åˆ—æ•°**ï¼š`columns-2 md:columns-3 lg:columns-5 xl:columns-5`
  - ğŸ¯ **è£…é¥°å…ƒç´ **ï¼šéšæœºä½ç½®çš„å°åœ†ç‚¹ã€ç²¾é€‰æ˜Ÿæ ‡ã€é«˜çº§çš‡å† æ ‡è®°
  - ğŸ¨ **æ·±è‰²å¡ç‰‡**ï¼š`bg-[#1a1a1a]` èƒŒæ™¯ï¼Œé‡‘è‰²æ‚¬åœè¾¹æ¡†æ•ˆæœ

- ğŸ® **äº¤äº’ä½“éªŒå¢å¼º**ï¼š
  - âœ¨ **é­”æ³•ä¸»é¢˜æ–‡æ¡ˆ**ï¼š"Magic Gallery"ã€"Load More Magic"
  - ğŸ¯ **ä¸è§„åˆ™æŒ‰é’®å½¢çŠ¶**ï¼šä½¿ç”¨ `clipPath` åˆ›é€ æ‰‹å·¥æ„Ÿ
  - ğŸ­ **æ‚¬åœåŠ¨ç”»**ï¼šå¡ç‰‡æ‚¬åœæ—¶å›æ­£ï¼Œå¢å¼ºå±‚æ¬¡æ„Ÿ

- ğŸ”§ **åŠŸèƒ½å®Œå–„**ï¼š
  - ğŸ“± **ç§»åŠ¨ç«¯å¯¼èˆªèœå•** 
  - ğŸ”— **åˆ†äº«å’Œä¸‹è½½åŠŸèƒ½**
  - ğŸ’¬ **è¯„è®ºç³»ç»Ÿäº¤äº’**
  - â¤ï¸ **ç‚¹èµåŠŸèƒ½**

**æŠ€æœ¯å®ç°ï¼š**
- ğŸ“ **æ–‡ä»¶è·¯å¾„**ï¼š`app/gallery/gallery-client.tsx`
- ğŸ”„ **æ ·å¼æ¥æº**ï¼šæ¢å¤è‡ªå¤‡ä»½æ–‡ä»¶ `app/gallery/page.tsx.backup`
- ğŸ¨ **è®¾è®¡ç†å¿µ**ï¼šæ‰‹å·¥è‰ºæœ¯æ„Ÿ vs ç°ä»£å•†ä¸šæ„Ÿ
- ğŸ–¼ï¸ **å›¾ç‰‡ç»„ä»¶**ï¼šç»§ç»­ä½¿ç”¨ `SimpleImage` ç¡®ä¿åŠ è½½æ€§èƒ½

**è§†è§‰å¯¹æ¯”ï¼š**
| æ–¹é¢ | ä¹‹å‰ï¼ˆè‰ºæœ¯é£æ ¼ï¼‰ | ä¿®æ”¹åï¼ˆç°ä»£é£æ ¼ï¼‰ | ç°å·²æ¢å¤ |
|------|------------------|-------------------|----------|
| èƒŒæ™¯ | ğŸ¨ é»‘è‰²é­”æ³•èƒŒæ™¯ | ğŸ”† æ¸å˜ç°ä»£èƒŒæ™¯ | âœ… é»‘è‰²é­”æ³•èƒŒæ™¯ |
| å­—ä½“ | ğŸ–‹ï¸ Comic Sans æ‰‹ç»˜æ„Ÿ | ğŸ“± ç°ä»£æ— è¡¬çº¿å­—ä½“ | âœ… Comic Sans æ‰‹ç»˜æ„Ÿ |
| å¡ç‰‡ | ğŸ­ æ·±è‰²+æ—‹è½¬æ•ˆæœ | ğŸ’ ç™½è‰²åŠé€æ˜ | âœ… æ·±è‰²+æ—‹è½¬æ•ˆæœ |
| ä¸»é¢˜è‰² | ğŸŒŸ é‡‘è‰² (#d4a574) | ğŸ¯ å¤šå½©æ¸å˜ | âœ… é‡‘è‰² (#d4a574) |
| è£…é¥° | ğŸª å¤§é‡è‰ºæœ¯å…ƒç´  | ğŸ¢ ç®€æ´å•†ä¸šé£æ ¼ | âœ… å¤§é‡è‰ºæœ¯å…ƒç´  |

è¿™æ¬¡æ¢å¤ç¡®ä¿äº†Galleryé¡µé¢ä¿æŒAIMAGICAå¹³å°ç‹¬ç‰¹çš„é­”æ³•è‰ºæœ¯é£æ ¼ï¼Œä¸ºç”¨æˆ·æä¾›æ›´åŠ æ²‰æµ¸å¼çš„è‰ºæœ¯åˆ›ä½œä½“éªŒã€‚

---

**Start creating stunning AI art today at [aimagica.ai](https://aimagica.ai)**

*Transform your imagination into reality with the power of artificial intelligence.* 